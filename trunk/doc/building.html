<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--
  HPCToolkit Documentation: Editing within Netscape/Mozilla Composer
  is possible, but it generates strange stuff in-line.  
  Please use an ordinary text editor.
-->

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

  <title>HPCToolkit: Downloading, Building and Testing</title>

  <link rel='stylesheet' type='text/css' href='styleForAll.css'>
</head>

<body>

<!-- ********************************************************************** -->

<script language="JavaScript" src="header_hpctools.js"></script>

<!-- ********************************************************************** -->

<div id="main">

<p class="lastupdated">Last Updated 30 July 2003</p>

<a name="toc"></a>
<h2>Downloading, Building and Installing HPCToolkit</h2>

<h2>Contents</h2>
<ul>
  <li><a href="#sources">Downloading the Sources</a>

  <li><a href="#environment">Environment</a>

  <li>Building
  <ul>
    <li><a href="#overview">Build Overview</a>
    <li><a href="#buildnotes">Build Notes</a>
    <li><a href="#xlib_binutils">External Library: GNU binutils</a>
    <li><a href="#xlib_xercesc">External Library: Xerces-C++</a>
    <li><a href="#xlib_oa">External Library: OpenAnalysis</a>
    <li><a href="#hpctoolkit">HPCToolkit</a>
    <li><a href="#evaluation">Evaluation</a>
    <li><a href="#troubleshooting">Troubleshooting</a>
  </ul>

  <li><a href="#installing">Installing</a>
</ul>

<!-- ********************************************************************** -->

<a name="sources"></a>

<h2>Downloading the Sources</h2>
<p><i>[<a href="#toc">Contents</a>]</i>

<p>To reduce the effort needed to distribute HPCToolkit, we have opted
to distribute it in source form only. Source files for the toolkit and
external libraries it requires are distributed via anonymous CVS
checkout.

			<ol class="noindent">
				<li>
				<p>To retrieve the source files from CVS, you will need to download <code><a href="http://hipersoft.cs.rice.edu/cvs/hipersoft-anonssh">hipersoft-anonssh</a></code>, 
a ssh script that contains a key that will grant you read-only access
to the Hipersoft CVS repositories at Rice University.  Save this script in
<code>${HOME}/bin/hipersoft-anonssh</code>.

				<li>
				<p>Set up the required CVS environment variables to enable you to 
access the HPCToolkit repository.

				<div class="indent">
  <i>(csh variants)</i><br>
  <code>setenv CVS_RSH ${HOME}/bin/hipersoft-anonssh</code><br>
					<code>setenv CVSROOT :ext:anoncvs@128.42.2.152:/Volumes/cvsrep/developer</code><br>
					<br>
  <i>(sh variants)</i><br>
  <code>export CVS_RSH=${HOME}/bin/hipersoft-anonssh</code><br>
					<code>export CVSROOT=:ext:anoncvs@128.42.2.152:/Volumes/cvsrep/developer</code></div>
				<li>
				<p>Use CVS to check out the HPCToolkit sources using the command

			</ol>
			<div class="indent">
				<p><code>cvs co HPCToolkit_all_source</code><br>
						<br>
					Please note - there are several HPCToolkit CVS modules. Please visit our <a href="http://hipersoft.cs.rice.edu/cvs/#rice_repositories">CVS information pages</a> for a complete list of available modules. <br>
					</p>
			</div>
			<!-- ********************************************************************** --><a name="environment"></a>

<h2>Environment</h2>
<p><i>[<a href="#toc">Contents</a>]</i>

<ol class="noindent">

<li>
<p>Before building, installing, or using the tools, certain
environment variables need to be set.  To set these variables and to
include a reference to the tools in your PATH, source either
<a href="../Sourceme-csh"><code>Sourceme-csh</code></a> or 
<a href="../Sourceme-sh"><code>Sourceme-sh</code></a>. 
The former will setup your environment for <code>csh</code> variants;
the latter will do so for <code>sh</code> variants.  
Before sourcing these files, the HPCTOOLKIT environment
variable should be set to the root directory of the HPCToolkit 
tree.  For example:

<div class="indent">
  <i>(csh variants)</i><br>
  <code>setenv HPCTOOLKIT "/my_path/HPCToolkit"</code><br>
  <code>source $HPCTOOLKIT/Sourceme-csh</code>
<br><br>
  <i>(sh variants)</i><br>
  <code>export HPCTOOLKIT="/my_path/HPCToolkit"</code><br>
  <code>source $HPCTOOLKIT/Sourceme-sh</code>
</div>

<p>You may wish to add these commands to your shell initialization files.</p>


<li>
<p>Our Perl-based tools require that you have some variant of Perl 5
installed and that it is in your path.  For the record, we have
succssfully used:

  <ul class="noindent">
    <li>5.004 (mips-IRIX64)
    <li>5.005 (alpha-OSF1, i686-Linux)
    <li>5.6.0 (alpha-OSF1, ia64-Linux)
    <li>5.6.1 (alpha-OSF1, ia64-Linux, sparc-SunOS)
  </ul>

</ol>


<!-- ********************************************************************** -->
<!-- ********************************************************************** -->

<h2>Building</h2>
<p><i>[<a href="#toc">Contents</a>]</i>

<div class="indent">

<!-- ********************************************************************** -->

<a name="overview"></a>

<h2>Build Overview</h2>
<p><i>[<a href="#toc">Contents</a>]</i>


<p>There are three external libraries -- OpenAnalysis, Xerces-C++ and
GNU binutils -- that must be built before HPCToolkit can be built,
installed and used.</p>

<p>It is possible to use versions of these libraries that may already
be installed on your system, but we do not support such
configurations.</p>

<!-- ********************************************************************** -->

<a name="buildnotes"></a>

<h2>Build Notes</h2>
<p><i>[<a href="#toc">Contents</a>]</i>

<ol class="noindent">

<li>
<p>HPCToolkit, OpenAnalysis and Xerces-C++ require an ANSI/ISO C/C++
compliant compiler.  GNU binutils requires a C compiler that also
supports a few GNU extensions.  Of course, the same C++ compiler
should be used for each component (because of templates and mangling).
    
<p>The list of compilers that we have successfully tested are listed
below.  (Special options or exceptions will be noted in the
instructions following.):

  <ul class="noindent">
    <li>alpha-OSF1:
      <ul class="noindent">
        <li>Compaq C++/C 6.2, 6.3, 6.5
        <li>GCC C++/C 3.2.1
      </ul>

    <li>i686-Linux:
      <ul class="noindent">
        <li>GCC C++/C 3.2.x
        <li>GCC C++/C 3.0.4
      </ul>

    <li>ia64-Linux:
      <ul class="noindent">
        <li>Intel C++/C 7.0, 7.1
        <li>Intel C++/C 6.0
        <li>GCC C++/C 3.2.x
        <li>GCC C++/C 3.0.4
      </ul>

    <li>mips-IRIX64:
      <ul class="noindent">
        <li>SGI MIPSpro C++/C 7.3.x, 7.4
        <li>GCC C++/C 3.2.1
      </ul>

    <li>sparc-SunOS:
      <ul class="noindent">
        <li>Sun Forte C++/C 5.3 (WorkShop 6 update 2 with patch 111685-01
            or greater (bug id 4466915))
        <li>Sun Forte C++/C 5.1 (WorkShop 6)
        <li>GCC C++/C 3.0.4
      </ul>
  </ul>

<li>
<p>Everywhere that `make' or `gmake' is used you should think GNU
make, not a vendor supplied make.  For the record, we have
successfully used:

  <ul class="noindent">
    <li>3.70 (alpha-OSF1, mips-IRIX64, sparc-SunOS)
    <li>3.76 (sparc-SunOS)
    <li>3.77 (alpha-OSF1)
    <li>3.78 (i686-Linux)
    <li>3.79 (alpha-OSF1, ia64-Linux, mips-IRIX64)
    <li>3.80 (alpha-OSF1)
  </ul>

</ol>


<!-- ********************************************************************** -->

<a name="xlib_binutils"></a>

<h2>External Library: GNU binutils</h2>
<p><i>[<a href="#toc">Contents</a>]</i>


<h3>Notes</h3>

<p>Most of the C compilers listed in <a href="#buildnotes">Build
Notes</a> can compile binutils.  Below is a list of exceptions or
special options.</p>

<ul>
  <li>GCC C 2.9x can also be used.
  <li>ia64-Linux:
    <ul class="noindent">
      <li>Intel C <i>cannot</i> be used; use GCC C.
    </ul>
  <li>mips-IRIX64:
    <ul class="noindent">
      <li>SGI C <i>cannot</i> be used; use GCC C.
      <li>GCC C should be compiled with <code>-mabi=64</code>, e.g.
         <code>CFLAGS='-O -mabi=64'</code>.
    </ul>
</ul>


<h3>Building</h3>

<ol class="noindent">

<li>
<p>Change to the binutils directory.

<div class="indent">
<code>cd binutils</code>
</div>

<li>
<p>Configure, build and install.  Run make with the C compiler (CC)
and compilation options (CFLAGS).  Since this will produce a lot of
output, you may want to redirect it to a file.  For example:

<div class="indent">
<code>gmake CC='gcc' CFLAGS='-O'</code><br>
</div>

<li>
<p>(Optional) Clean the build files.  

<div class="indent">
  <code>gmake clean</code><br>
</div>

<!--
The second command will remove unnecessary <i>installed</i> binutils
tools.
  <code>gmake minimize_install</code>
-->

</ol>


<!-- ********************************************************************** -->

<a name="xlib_xercesc"></a>

<h2>External Library: Xerces-C++</h2>
<p><i>[<a href="#toc">Contents</a>]</i>

<h3>Notes</h3>

<p>Below is a list of special options for compiling Xerces-C++.

<ul>
  <li>mips-IRIX64:
    <ul class="noindent">
      <li>SGI C++ should be compiled with <code>-64</code>, e.g.
         <code>CXXFLAGS='-64'</code>.
      <li>GCC C++ should be compiled with <code>-mabi=64</code>, e.g.
         <code>CXXFLAGS='-mabi=64'</code>.
    </ul>
</ul>


<h3>Building</h3>

<ol class="noindent">

<li>
<p>Change to the Xerces-C++ directory.

<div class="indent">
<code>cd xercesc</code>
</div>

<li>

<p>Configure, build and install.  Run make with the C++ and C compiler
(CXX and CC, respectively) and compilation options (CXXFLAGS).  Since
this will produce a lot of output, you may want to redirect it to a
file.  For example:


<div class="indent">
<code>gmake CXX='g++' CC='gcc'</code><br>
</div>

<li>
<p>(Optional) Clean the build files.

<div class="indent">
  <code>gmake clean</code>
</div>

</ol>


<!-- ********************************************************************** -->

<a name="xlib_oa"></a>

<h2>External Library: OpenAnalysis</h2>
<p><i>[<a href="#toc">Contents</a>]</i>


<h3>Notes</h3>

<p>Below is a list of special options for compiling OpenAnalysis.

<ul>
  <li>mips-IRIX64:
    <ul class="noindent">
      <li>SGI C++ should be compiled with <code>-64</code>, e.g.
         <code>CXXFLAGS='-O -64'</code>.
      <li>GCC C++ should be compiled with <code>-mabi=64</code>, e.g.
         <code>CXXFLAGS='-O -mabi=64'</code>.
    </ul>
</ul>


<h3>Building</h3>

<ol class="noindent">

<li>
<p>Change to the OpenAnalysis directory.

<div class="indent">
<code>cd OpenAnalysis</code>
</div>

<li>
<p>Configure, build and install.  Run make with the C++ compiler (CXX)
and compilation options (CXXFLAGS).  Since this will produce a lot of
output, you may want to redirect it to a file.  For example:

<div class="indent">
<code>gmake CXX='g++' CXXFLAGS='-O'</code><br>
</div>

<li>
<p>(Optional) Clean the build files.

<div class="indent">
  <code>gmake clean</code>
</div>

</ol>


<!-- ********************************************************************** -->

<a name="hpctoolkit"></a>

<h2>HPCToolkit</h2>
<p><i>[<a href="#toc">Contents</a>]</i>

<h3>Notes</h3>

<p>Below is a list of exceptions or special options for compiling
HPCToolkit.  (We hope to eliminate this eyesore with Autoconf/make,
but until then...)</p>

<ol class="noindent">

<li>
<p>Unfortunately, some otherwise ANSI/ISO compliant C++ compilers do
not fully support the definition for including C library routines.
For example, C headers are now included using the
<code>&lt;cheader&gt;</code> syntax (as opposed to
<code>&lt;header.h&gt;</code>) and functions are in the
<code>std</code> namespace.  If your compiler does not support this
standard, you will need to compile HPCToolkit with
<code>-DNO_STD_CHEADERS</code>.

  <ul class="noindent">
    <li>alpha-OSF1:
      <ul class="noindent">
        <li>Compaq C++/C 6.2 (<i>use <code>-DNO_STD_CHEADERS</code></i>)
      </ul>

    <li>mips-IRIX64:
      <ul class="noindent">
        <li>SGI MIPSpro C++/C 7.3.x, 7.4
            (<i>use <code>-DNO_STD_CHEADERS</code></i>)
      </ul>
  </ul>

<li>
<p>Compiling templates: HPCToolkit and OpenAnalysis both use templates.
Most compilers are now relatively good at handling templates without
special options or tightrope walking.  However, a few comments which
apply to building both HPCToolkit and OpenAnalysis are apropos.

  <ul class="noindent">
    <li>Sun and SGI compilers: Both of these compilers rely on the
      compiler itself to perform some archiving duties to ensure that
      that the correct number of template definitions are included in
      archives. The system archiver should <i>not</i> be used.  If however
      you wish to substitute for the GCC compiler, make sure to use
      your system archiver.

    <li>Compaq compiler: The Compaq compiler uses a rather cumbersome
      implementation of a template repository.  The repository must be
      manually specified both at compile time and at archiving or link
      time.  Use the system archiver.  If you wish to substitute the
      GCC compiler, make sure to undefine/remove any template
      repository options.

    <li>GCC: Use default template handling and the system archiver.

    <li>Intel Compilers: Use default template handling and the system
      archiver.

  </ul>
</ol>


<h3>Building</h3>

<ol class="noindent">

<li>
<p>Configure the make system

<ul class="noindent">

  <li>Open <code>${HPCTOOLKIT}/src/Makeinclude.config.${HPCTOOLKIT_PLATFORM}</code>
      in an editor.  

  <li>Verify your C++ compiler (<code>CXX</code>), C compiler
     (<code>CC</code>) and archiver (<code>AR</code>) are correctly
     set.
 
  <li>Add/remove <code>-DNO_STD_CHEADERS</code> to the
     <code>CXX</code> command line if necessary. 

  <li>On alpha-OSF1, verify that <code>SPECIFY_CXX_TREPOSITORY</code>
      is correctly set.

</ul>


<li>
<p>Build and install (local installation).  By default, the toolset
will be compiled with debugging information; passing
<code>RELEASE=1</code> to `make' will turn this off and also turn on
compiler optimizations.</p>


<div class="indent">
<code>cd $HPCTOOLKIT/src</code><br>
<code>gmake RELEASE=1</code>
</div>


<li>
<p>(Optional) Clean the build files.

<div class="indent">
  <code>gmake veryclean</code>
</div>

</ol>

<p>The HCToolkit binaries will be copied to
<code>${HPCTOOLKIT}/bin/${HPCTOOLKIT_PLATFORM}</code>.  
Platform independent tools will be copied to <code>${HPCTOOLKIT}/bin</code>.
In order to easily use the tools on some shells, you may need to indicate 
that the PATH ought to be researched.  For example, on <code>csh</code> or
<code>tcsh</code> execute <code>rehash</code>.</p>


<!-- ********************************************************************** -->

<a name="evaluation"></a>

<h2>Evaluation</h2>
<p><i>[<a href="#toc">Contents</a>]</i>


<p>Yeah! If everything is built and installed, take a sip of your
favorite beverage and consider trying the toolkit out.

<!-- consider running the <a href="testing.html">tests</a>. -->

<p>Grrr! If everything fails miserably, take a sip of your favorite
beverage and send us some mail.  Also consult the troubleshooting
notes below.</p>

<!-- ********************************************************************** -->

<a name="troubleshooting"></a>

<h2>Troubleshooting</h2>
<p><i>[<a href="#toc">Contents</a>]</i>


<ol class="noindent">

<li>
<p>GNU binutils will not build.  For addition information go to the
binutils <a href="http://sources.redhat.com/binutils">website</a>.</p>

<!-- http://www.gnu.org/software/binutils/ -->


<li>
<p>When compiling OpenAnalysis with GCC 3.0.4 and <code>-0</code>, there is a
compilation error similar to:</p>

<div class="indent">
  <pre>DomTree.C:73: Internal compiler error in expand_end_loop, at stmt.c:2527</pre>
</div>

<p>OpenAnalysis exposes a bug in the GCC 3.0.4 optimizer.  Turn off
optimization and recompile.</p>


<li>
<p>When linking HPCToolkit, there is an error message similar to:

<div class="indent">
  <pre>undefined reference to `__udivsi3'</pre>
</div>

<p>Most likely you compiled GNU binutils with GCC and are compiling
HPCToolkit with a non-GCC compiler.  Unfortunately, sometimes the GNU
binutils libraries are not fully self-contained, and lack some symbols
that are defined in <code>libgcc.a</code> or <code>libgcc_s.so</code>
(depending on which compiler version you have).  

<p>There are two solutions to this problem.  First, you can compile
HPCToolkit with GCC and the appropriate library will be automatically
provided during the linking stage.  Secondly, you can continue
compiling with a non-GCC compiler while adding the appropriate library
to the link line.  To do this, first determine which library your
version of GCC uses.  Then, open the file
<code>${HPCTOOLKIT}/src/Makeinclude.config.${HPCTOOLKIT_PLATFORM}</code>
in an editor and modify the <code>USER_C_LDFLAGS</code> variable.  For
example, the lines below would add <code>libgcc.a</code> or
<code>libgcc_s.so</code>, respectively, to the link:

<div class="indent">
  <code>USER_C_LDFLAGS = /gcc_lib_path/libgcc.a</code><br>
  <code>USER_C_LDFLAGS = /gcc_lib_path/libgcc_s.so</code>
</div>

</ol>

<!-- ********************************************************************** -->

</div>

<!-- end: Building -->

<!-- ********************************************************************** -->
<!-- ********************************************************************** -->


<a name="installing"></a>

<h2>Installing</h2>
<p><i>[<a href="#toc">Contents</a>]</i>

<p>Once the toolkit is built, it can be used `as is'.  However, users
who are not interested in modifying the sources may desire as compact
an installation as possible.  We have prepared the
<code>hpcinstall</code> script for this purpose.

<p>The <code>hpcinstall</code> script will install HPCToolkit for
end-user use.  The script will copy the required executables, DSOs and
documentation to a given installation path.  If desired, the toolkit
can be installed multiple times to different locations or the
resulting installation can be tar'd and zipped for subsequent
transfer.  The installation is self-contained and will consume
significantly less disk space than the sources (GNU binutils and
Xerces-C++ are rather large), which can safely be removed.

<p>For example, to install the toolkit to <code>/my_path</code>:

<div class="indent">
<code>${HPCTOOLKIT}/tools/hpcinstall /my_path</code>
</div>

<p>You can run <code>hpcinstall</code> without any options for more
information.

<p>To use the resulting installation, (re)set your environment
variables as explained in the <a href="#environment">Environment</a>
section to point to the <i>installed</i> version.


<!-- ********************************************************************** -->

<script language="JavaScript" src="footer_hpctools.js"></script>

<!-- ********************************************************************** -->

</div> <!-- id=main -->

</body>
</html>
