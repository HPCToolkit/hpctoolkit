#!/bin/sh
#
# Usage: wrap-tool.sh [wrap options] compiler arg ...
#
# $Id$
#

die()
{
    echo "Error: $*" 1>&2
    exit 1
}

usage()
{
    cat <<EOF
Usage: wrap-tool.sh [wrap options] compiler arg ...
EOF
    exit 0
}

#
# Our options come before the compiler/linker command line.
#
wrap_options=
insert_files=
verbose=no
while test "x$1" != x
do
    case "$1" in
	-h | --help )
	    usage
	    ;;

	-i )
	    test "x$2" != x || die "missing argument: $*"
	    insert_files="${insert_files} $2 "
	    shift ; shift
	    ;;

	-v | --verbose )
	    verbose=yes
	    shift
	    ;;

	-w )
	    test "x$2" != x || die "missing argument: $*"
	    wrap_options="${wrap_options} -Wl,--wrap,$2 "
	    shift ; shift
	    ;;

	-- )
	    shift
	    break
	    ;;

	* )
	    break
	    ;;
    esac
done

#
# Must have a compiler/linker command and at least one argument.
#
test "x$1" != x || die "missing compiler/linker command"
test "x$2" != x || die "no arguments"

command="$1"
shift

if test "$verbose" = yes ; then
    echo "new command line: " $command $wrap_options "$@" $insert_files
fi

exec $command $wrap_options "$@" $insert_files
