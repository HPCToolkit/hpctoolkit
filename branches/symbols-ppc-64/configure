#! /bin/sh
#

# =============== utility functions ================
usage()
{
    cat <<EOF
configuration options:
   --prefix=ABSOLUTE_PATH
        The std gnu prefix argument for installation control. (e.g. \$prefix/bin holds
          executables, \$prefix/lib holds libraries, etc ...)

   --xed2-dir=ABSOLUTE_PATH
        Where to find the XED2 library.
        Defaults to /projects/hpc/pkgs/XED2

  --symtabAPI-dir=PATH
        Where to find the symtabAPI src pkg (needed for include files)
        Defaults to ../SymtabAPI-f-paradyn

        NOTE: the symtabAPI *library* is expected to be in
          $prefix/lib
  --arch=x86|ppc
        Defaults to x86
EOF
}

# ================ script =====================

conf_home=`dirname $0`
opt_prefix='.'

if [ -d /projects/hpc/pkgs ]; then
  PKGS=/projects/hpc/pkgs
elif [ -d /projects/pkgs ]; then
  PKGS=/projects/pkgs
else
  PKGS=$conf_home
fi

####### defaults ###########

opt_xed2_dir=$PKGS/XED2
opt_symtabAPI_dir=$conf_home/../symtabAPI-f-paradyn
opt_arch=x86

while [ $# -gt 0 ]
do
    case $1 in
	--prefix=*) opt_prefix=${1#--prefix=}
	          ;;

	--symtabAPI-dir=*) opt_symtabAPI_dir=${1#--symtabAPI-dir=}
	          ;;

	--xed2-dir=*) opt_xed2_dir=${1#--xed2-dir=}
	          ;;

        --arch=*) opt_arch=${1#--arch=}
                  ;;
	--*) printf "invalid option: '$1'\n";
             usage
	    exit 1;
	    ;;

	-*) printf "invalid option: '$1'\n";
            usage
	    exit 1;
	    ;;

         *) break ;;
    esac
    shift
done

opt_prefix=${opt_prefix:="."}
opt_prefix=${opt_prefix%/}

## configure Makefile (by creating Makefile.conf)

cat <<EOF > Makefile.conf
PREFIX         := $opt_prefix
src_dir        := $conf_home
XED2_DIR       := $opt_xed2_dir
symtabAPI_home := $opt_symtabAPI_dir
arch           := $opt_arch
EOF

cp $conf_home/Makefile.in ./Makefile
