#!/bin/sh
#
#  SymtabAPI configure.
#
#  $Id$
#

PKG_NAME=symtabAPI
src=SymtabAPI-8.0
work="$src"

. ../build-utils/configure.inc
pre_configure
prefix="$symtabAPI_prefix"

cd "$work" || die "unable to cd: $work"

set -- \
    CC="$CC"  CFLAGS="$CFLAGS" \
    CXX="$CXX"  CXXFLAGS="$CXXFLAGS" \
    --prefix="$prefix" \
    --bindir="${prefix}/bin" \
    --includedir="${prefix}/include" \
    --libdir="${prefix}/lib" \
    --with-boost="$boost_prefix" \
    --with-libdwarf-incdir="$libdwarf_inc" \
    --with-libdwarf-libdir="$libdwarf_lib" \
    --with-libelf-incdir="$libelf_inc" \
    --with-libelf-libdir="$libelf_lib" \
    --with-default-component=SymtabAPI \
    --disable-testsuite \
    "$@"

if test -n "$is_cross_compile" ; then
    set -- --host="$host" "$@"
fi

echo ./configure "$@"
./configure "$@"
test $? -eq 0 || die "configure failed"

# Symtab configure doesn't fully save CC, CXX and flags from the
# config line, so we force them into make.config.local.

echo "adding CC, CXX and flags to make.config.local ..."
cat <<EOF >>"${symtabAPI_platform}/make.config.local"

# CC, CXX and flags from externals's top-level configure
HPC_CC = $CC
HPC_CXX = $CXX
HPC_CFLAGS = $CFLAGS
HPC_CXXFLAGS = $CXXFLAGS
EOF
test $? -eq 0 || die "configure failed"

post_configure
