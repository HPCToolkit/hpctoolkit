#!/bin/sh
#
#  Binutils install.
#
#  $Id$
#

PKG_NAME=binutils
src=version-binutils-2.20.1/binutils-2.20.1

. ../build-utils/configure.inc
pre_install
prefix="$binutils_prefix"

cd work || die "unable to cd: work"
work_dir=`pwd`

# NOTE: this must come after 'make_work_dir' or 'make_work_dir' breaks
cd "../${src}" || die "unable to cd: ${src}"
src=`pwd`

#
# Only install what we need.
#
dirs="libiberty bfd opcodes intl binutils"
for x in $dirs ; do
    echo "=> ${x}/install"
    cd ${work_dir}/${x}
    $MAKE install || die "unable to install ${x}"
done

#
# Copy extra headers: demangle.h plus its dependencies
#
dir_to="${prefix}/include/"
to_copy="${src}/include/demangle.h \
         ${src}/include/libiberty.h \
         ${src}/include/ansidecl.h"

echo "=> cp ${to_copy}"

mkdir -p "${dir_to}" || die "unable to mkdir: ${dir_to}"
for x in ${to_copy} ; do
    cp ${x} ${dir_to} || die "unable to install: ${x}"
done

#
# Libiberty doesn't obey --libdir and always installs into a multilib
# directory (lib64 or lib32).  Instead of hacking their Makefile, we
# just copy the libraries.
#
cd "$prefix" || die "unable to cd: $prefix"
for lib in lib64/lib* lib32/lib* ; do
    if test -f "$lib" ; then
	echo "cp $lib to lib"
	cp -f "$lib" lib
    fi
done

post_install
